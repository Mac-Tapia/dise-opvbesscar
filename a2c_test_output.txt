­ƒÜÇ GPU: NVIDIA GeForce RTX 4060 Laptop GPU
   VRAM: 8.6 GB
   CUDA: 12.1
   Entrenamiento A2C en GPU (red 256x256, n_steps=8)
   Device: CUDA

[0] VALIDACION DE SINCRONIZACION A2C
--------------------------------------------------------------------------------

================================================================================
[VALIDACION] Sincronizacion A2C v7.0 - Datasets OE2 Completos
================================================================================
  [OK] 1. BESS Capacity (2000 kWh)
  [OK] 2. BESS Max normalizacion (2000 kWh)
  [OK] 3. Solar Max (2887 kW)
  [OK] 4. Mall Max (3000 kW)
  [OK] 5. Chargers Max (3.7 kW)
  [OK] 6. BESS cols (25)
  [OK] 7. Solar cols (16)
  [OK] 8. Mall cols (6)
  [OK] 9. BESS obs cols (12)
  [OK] 10. Solar obs cols (10)

[OK] A2C sincronizado.\n
[0.5] VALIDACION CENTRALIZADA - ENTRENAMIENTO COMPLETO
--------------------------------------------------------------------------------

================================================================================
[VALIDACION DE ENTRENAMIENTO] A2C
================================================================================
  [OK] Episodes: 10 (CORRECTO)
  [OK] Timesteps: 87,600 (CORRECTO: 10 anos x 8760)
  [OK] solar       : data/oe2/Generacionsolar/pv_generation_citylearn2024.csv (0.9 MB)
  [OK] chargers    : data/oe2/chargers/chargers_ev_ano_2024_v3.csv (72.9 MB)
  [OK] mall        : data/oe2/demandamallkwh/demandamallhorakwh.csv (0.4 MB)
  [OK] bess        : data/oe2/bess/bess_ano_2024.csv (2.0 MB)
  [OK] Observation dim: 156 (>=  27 requeridas)
  [OK] Action dim: 39 (1 BESS + 38 sockets)
  [OK] Reward weights loaded (co2_focus mode)
  [OK] CO2 factor: 0.4521
  [OK] Chargers: 19
  [OK] Total sockets: 38

================================================================================
[RESULTADO] [OK] A2C PREPARADO PARA ENTRENAMIENTO COMPLETO
================================================================================
Config:
  - Episodes: 10 (10 anos completos)
  - Timesteps: 87,600 (87,600 pasos)
  - Observation: 156 dims
  - Action: 39 dims
  - Datasets: TODOS cargados
  - Multiobjetivo: SI (27 columnas observables)
  - Validacion: OK [OK]
[OK] Entrenamiento COMPLETO garantizado: 10 episodios ├ù 87,600 steps ├ù 27 observables ├ù multiobjetivo.

[1] CARGAR CONFIGURACION Y CONTEXTO MULTIOBJETIVO
--------------------------------------------------------------------------------
  OK Config loaded: 5 keys
  REWARD WEIGHTS (ACTUALIZADOS 2026-02-08 - LOG SAC):
    CO2 grid (0.35): Minimizar importacion grid
    Solar (0.20): Autoconsumo PV
    EV satisfaction (0.30): SOC 90%
    Cost (0.10): Minimizar costo
    Grid stability (0.05): Suavizar picos
  [Valores cargados: CO2=0.35, Solar=0.20, EV=0.30, Cost=0.10, Grid=0.05]

  OK Contexto Iquitos:
    - Grid CO2: 0.4521 kg CO2/kWh
    - EV CO2 factor: 2.146 kg CO2/kWh
    - Chargers: 19
    - Sockets: 38
    - Daily capacity: 270 motos + 39 mototaxis

[2] CARGAR DATASET CITYLEARN V2 (COMPILADO)
--------------------------------------------------------------------------------
  Dataset precompilado: data\processed\citylearn\iquitos_ev_mall
  OK Dataset: data\processed\citylearn\iquitos_ev_mall

[3] CARGAR DATASETS OE2 DESDE DATA_LOADER CENTRALIZADO (igual SAC/PPO)
--------------------------------------------------------------------------------
  Cargando datasets OE2 compilados...
[3] CARGAR DATASET DESDE data/iquitos_ev_mall (COMPILADO POR data_loader)
--------------------------------------------------------------------------------
  [SOLAR] Desde data/iquitos_ev_mall/solar_generation.csv: columna=energia_kwh | 8292514 kWh/ano (8760h)
         CO2 indirecto solar (calculado): 3,749,011 kg/a├▒o
  [CHARGERS] Cargando TODAS las columnas desde: data/iquitos_ev_mall/chargers_timeseries.csv
  [CHARGERS DETALLE] Columnas num├®ricas encontradas: 977
    Socket Power:      76 (potencia cargando)
    Socket SOC:       722 (estado de carga completo)
    CO2 Reducci├│n:    236 (impacto ambiental)
    Motos:            186 (m├®tricas motos)
    Mototaxis:         54 (m├®tricas mototaxis)
    Energ├¡a:          231 (acumulados)
    Chargers:         228 (agregados)
    Otros:              8
    ============================================================
    TOTAL USADO:      977 columnas (vs 38 antes)
    MEJORA:           X25.7 m├ís informaci├│n disponible Ô£ô
         CO2 DIRECTO motos:          300,449 kg/a├▒o
         CO2 DIRECTO mototaxis:       29,581 kg/a├▒o
         CO2 DIRECTO TOTAL:          330,030 kg/a├▒o
         CO2 Reducci├│n disponible: 236 m├®tricas, Total: 4,817,654,784 kg
  [CHARGERS] DATASET REAL: 977 features | Demanda total: 11683136512 kWh/ano
  [MALL] Cargando desde: data/iquitos_ev_mall/mall_demand.csv
  [MALL] Desde data/iquitos_ev_mall/mall_demand.csv: 4424186 kWh/ano (promedio 505.0 kW/h)
  [BESS] Cargando desde: data/iquitos_ev_mall/bess_timeseries.csv
  [BESS] SOC media: 75.6%
  [EV] Cargando DATOS REALES COMPLETOS desde: chargers_timeseries.csv
  [EV] METRICAS CARGADAS: 5 arrays agregados + v7.2 SOC por socket
       SOC promedio: 40.3%
       Sockets SOC individual: (8760, 38) (8760 horas ├ù 38 sockets)
       Vehiculos activos: 88,989/ano
       Potencia carga: 408,281 kWh/ano
  [CHARGER STATS] Valores por defecto: max_power=7.4 kW, mean=4.6 kW

[4] CREAR ENVIRONMENT CON DATOS COMPILADOS DESDE data/iquitos_ev_mall
--------------------------------------------------------------------------------
  OK Environment creado (v7.2 con TODOS los datos OE2 + SOC real por socket)
    - Observation: (156,) (156-dim)
    - Action: (39,)
    - Socket SOC real: (8760, 38) (8760 horas ├ù 38 sockets)
    - EV metricas: ['soc_current', 'soc_target', 'active_count', 'charging_power', 'vehicle_count']
    - Chargers CO2 (DIRECTO - EV): ['co2_motos_kg', 'co2_mototaxis_kg', 'co2_total_kg', 'cost_soles']
    - Solar CO2 (INDIRECTO): ['co2_avoided_kg']

[5] CREAR A2C AGENT
--------------------------------------------------------------------------------
  OK A2C agent creado (DEVICE: CUDA)
    - Learning rate: 0.0003
    - N steps: 16
    - Gamma: 0.99
    - GAE lambda: 0.95
    - Entropy coef: 0.01
    - Value coef: 0.5
    - Max grad norm: 0.5
    - Use RMSProp: False
    - Normalize advantage: True

[6] ENTRENAR A2C
--------------------------------------------------------------------------------

================================================================================
  [GRAPH] CONFIGURACION ENTRENAMIENTO A2C (100% DATOS REALES OE2)
     Episodios: 10 ├ù 8,760 timesteps = 87,600 pasos
     Device: CUDA
     Velocidad: ~650 timesteps/segundo
     Duracion: ~134 segundos (GPU RTX 4060)
     Datos: REALES OE2 (chargers_ev_ano_2024_v3.csv 38 sockets, 1,700 kWh BESS max SOC, 4.05 MWp solar)
     Network: 256x256 (on-policy A2C), n_steps=8 (updates frecuentes)
     Output: result_a2c.json, timeseries_a2c.csv, trace_a2c.csv

  REWARD WEIGHTS (CO2_FOCUS):
    CO2 grid (0.35): Minimizar importacion
    Solar (0.20): Autoconsumo PV
    EV satisfaction (0.30): SOC 90%
    Cost (0.10): Minimizar costo
    Grid stability (0.05): Suavizar picos
================================================================================
  ENTRENAMIENTO EN PROGRESO:
  ----------------------------------------------------------------------------
  [BESS REAL] Cargado: 8760 horas
  Step   5,000/87,600 (  5.7%) | Ep=0 | R_avg=  0.00 | 595 sps | ETA=2.3min
  Step  10,000/87,600 ( 11.4%) | Ep=1 | R_avg=2700.44 | 586 sps | ETA=2.2min
  Step  15,000/87,600 ( 17.1%) | Ep=1 | R_avg=2700.44 | 561 sps | ETA=2.2min
  Step  20,000/87,600 ( 22.8%) | Ep=2 | R_avg=2880.79 | 542 sps | ETA=2.1min
  Step  25,000/87,600 ( 28.5%) | Ep=2 | R_avg=2880.79 | 533 sps | ETA=2.0min
  Step  30,000/87,600 ( 34.2%) | Ep=3 | R_avg=2979.04 | 528 sps | ETA=1.8min
  Step  35,000/87,600 ( 40.0%) | Ep=3 | R_avg=2979.04 | 524 sps | ETA=1.7min
