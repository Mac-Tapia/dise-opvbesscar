[BASELINE] Baseline modules not available: No module named 'src'
================================================================================
[PRE-PASO] VALIDAR SINCRONIZACION CON 5 DATASETS OE2
================================================================================
  [OK] solar: 8,760 filas x 11 columnas (pv_generation_citylearn2024.csv)
  [OK] chargers_hourly: 8,760 filas x 353 columnas (chargers_ev_ano_2024_v3.csv)
  [OK] chargers_stats: 38 filas x 4 columnas (chargers_real_statistics.csv)
  [OK] bess: 8,760 filas x 25 columnas (bess_ano_2024.csv)
  [OK] mall_demand: 8,760 filas x 2 columnas (demandamallhorakwh.csv)

  SINCRONIZACION OE2 -> CityLearn:
    Solar PVGIS:          8,760 horas
    Chargers 38 sockets:          8,760 horas x 38 sockets (19 chargers ├ù 2)
    BESS SOC:             8,760 horas
    Mall Demand:          8,760 horas
  [OK] Todos los datasets OE2 sincronizados
================================================================================

[PRE-PASO] LIMPIEZA DE CHECKPOINTS PPO
--------------------------------------------------------------------------------
  Eliminados 5 archivos de checkpoint

================================================================================
ENTRENAR PPO - MULTIOBJETIVO CON DATOS REALES - 10 EPISODIOS
================================================================================
Inicio: 2026-02-14 08:34:50

GPU DISPONIBLE: NVIDIA GeForce RTX 4060 Laptop GPU
  RAM: 8.6 GB
  CUDA: 12.1

2026-02-14 08:34:52,524 | __main__ | INFO | Device: cuda | Batch: 256 | Epochs: 3
[PASO 1] Cargar configuracion y contexto OE2
--------------------------------------------------------------------------------
2026-02-14 08:34:52,530 | __main__ | INFO | Config validado: default.yaml OK
  REWARD WEIGHTS (ACTUALIZADOS 2026-02-07):
    CO2 grid (0.50): Minimizar importacion grid
    Solar (0.20): Autoconsumo PV
    EV satisfaction (0.30): SOC 90% (PRIORIDAD MAXIMA)
    Cost (0.10): Minimizar costo
    Grid stability (0.05): Suavizar picos
  [Valores cargados: CO2=0.35, Solar=0.20, EV=0.30, Cost=0.10, Grid=0.05]

[PASO 2] Cargar datos OE2 (8760 horas = 1 ano)
--------------------------------------------------------------------------------
2026-02-14 08:34:52,530 | __main__ | INFO | Solar REAL (CityLearn v2): columna='potencia_kw' | 8292514 kWh/ano (8760h)
2026-02-14 08:34:52,675 | __main__ | INFO | Chargers REALES (socket power columns): 38 sockets | Demanda anual: 2463312 kWh
2026-02-14 08:34:52,675 | __main__ | INFO | Charger STATS (5to OE2): max_power=2.45-3.59 kW, mean_power=0.95 kW
2026-02-14 08:34:52,675 | __main__ | INFO | Mall REAL: 12368653 kWh/a├▒o (promedio 1411.9 kW/h)
2026-02-14 08:34:52,690 | __main__ | INFO | BESS REAL: SOC media 48.1% (archivo: bess_ano_2024.csv)

[PASO 3] Crear environment Gymnasium
--------------------------------------------------------------------------------
2026-02-14 08:34:52,690 | __main__ | INFO | VecNormalize aplicado: norm_obs=True, norm_reward=True (gamma=0.85)
2026-02-14 08:34:52,690 | __main__ | INFO | Environment creado:
2026-02-14 08:34:52,690 | __main__ | INFO |   Observation: (156,)
2026-02-14 08:34:52,690 | __main__ | INFO |   Action: (39,)
2026-02-14 08:34:52,690 | __main__ | INFO |   Timesteps/episodio: 8760 (1 ano completo)

[PASO 4] Crear agente PPO
--------------------------------------------------------------------------------
2026-02-14 08:34:52,690 | __main__ | INFO | LR Schedule habilitado: 1.50e-04 ÔåÆ 0 (lineal sobre 87600 timesteps)
2026-02-14 08:34:53,949 | __main__ | INFO | PPO creado: LR=schedule(1.50e-04ÔåÆ0), n_steps=2048, target_kl=0.05, device=cuda
  Hiperparametros PPO v5.0 [Papers: Schulman 2017, Engstrom 2020, Andrychowicz 2021]:
    Learning Rate:     0.000150 ÔåÆ 0 (schedule lineal, CR├ìTICO)
    N Steps (rollout): 2048  (m├ís contexto = mejor value function)
    Batch Size:        256  (minibatch dentro del rollout)
    Epochs per update: 3  (3-10, mas = sample efficiency pero overfitting)
    Gamma:             0.85  (REDUCIDO para episodios de 8760 pasos)
    Clip Range (eps):  0.2  (0.1-0.3, limita cambio de politica)
    GAE Lambda:        0.95  (0.9-0.97, bias-variance tradeoff)
    Entropy Coef:      0.01  (0.0-0.02, promueve exploracion)
    Value Coef:        0.5  (peso del value loss)
    Max Grad Norm:     0.5  (gradient clipping)
    Target KL:         0.05  (early stop si KL >, ESTABILIDAD)
    Clip Range VF:     None  (DESHABILITADO - da├▒a EV seg├║n Andrychowicz 2021)
    Normalize Adv:     True  (normalizar advantages)
    Actor Network:     [256, 256] (policy)
    Critic Network:    [512, 512] (value function, M├üS GRANDE)
    VecNormalize:      norm_obs=True, norm_reward=True (CLAVE para EV)

[PASO 5] ENTRENAMIENTO CON DATOS REALES OE2
--------------------------------------------------------------------------------
  CONFIGURACION:
    Episodios: 10 x 8760 horas = 87,600 timesteps
    Datos: 100% REALES (OE2 Iquitos)
    Device: CUDA
    Duracion est.: ~1.3 minutos

  REWARD WEIGHTS (ACTUALIZADOS 2026-02-08 - LOG SAC):
    CO2 grid (0.35): Minimizar importacion grid
    Solar (0.20): Autoconsumo PV
    EV satisfaction (0.30): SOC 90%
    Cost (0.10): Minimizar costo
    Grid stability (0.05): Suavizar picos

  Iniciando entrenamiento...

  [BESS REAL] Cargado: 8760 horas
    Steps:   1,000 | Ep:  0 | Progreso:  11.4% | CO2_grid:  405,559 kg | CO2_evitado:  413,671 kg
    Steps:   2,000 | Ep:  0 | Progreso:  22.8% | CO2_grid:  788,686 kg | CO2_evitado:  817,426 kg
    Steps:   3,000 | Ep:  0 | Progreso:  34.2% | CO2_grid: 1,166,494 kg | CO2_evitado: 1,234,896 kg
    Steps:   4,000 | Ep:  0 | Progreso:  45.7% | CO2_grid: 1,514,456 kg | CO2_evitado: 1,629,404 kg
    [PPO] Step   4,096:
           KL: 0.0173 | Clip%: 21.1% | Entropy: 55.364
           Policy L: -0.0285 | Value L: 11.8644 | Expl.Var: -0.243
    ÔÜá´©Å  [PPO WARNING] Explained variance negativa: -0.243 (total: 1)
    Steps:   5,000 | Ep:  0 | Progreso:  57.1% | CO2_grid: 1,875,172 kg | CO2_evitado: 2,032,052 kg
    Steps:   6,000 | Ep:  0 | Progreso:  68.5% | CO2_grid: 2,248,853 kg | CO2_evitado: 2,460,930 kg
    ÔÜá´©Å  [PPO WARNING] KL alto: 0.0349 > 0.03 (count: 1)
    ÔÜá´©Å  [PPO WARNING] Explained variance negativa: -0.314 (total: 2)
    Steps:   7,000 | Ep:  0 | Progreso:  79.9% | CO2_grid: 2,638,536 kg | CO2_evitado: 2,916,497 kg
    Steps:   8,000 | Ep:  0 | Progreso:  91.3% | CO2_grid: 3,038,408 kg | CO2_evitado: 3,342,594 kg
    [PPO] Step   8,192:
           KL: 0.0622 | Clip%: 34.8% | Entropy: 55.477
           Policy L: -0.0523 | Value L: 0.9811 | Expl.Var: -0.164
    ÔÜá´©Å  [PPO CRITICAL] KL alto (0.0622) + Clip alto (34.8%) (count: 1)
        ÔåÆ PROBLEMA SEVERO: Updates demasiado agresivos
        ÔåÆ Acci├│n: Reducir LR, reducir n_epochs, o aumentar batch_size
    ÔÜá´©Å  [PPO WARNING] Explained variance negativa: -0.164 (total: 3)

  ================================================================
  EPISODIO 1 COMPLETADO
  ================================================================
    Reward Total (acumulado):      7,945.19

  CO2 CONTABILIDAD (SIN DOUBLE-COUNTING):
    Grid Import CO2:              3,360,488 kg
    - Reducido Indirecto:         2,978,349 kg (solar/BESS -> grid avoidance)
    - Reducido Directo:             681,139 kg (EV renewable -> avoid combustion)
    = Reducci├│n Total:            3,659,488 kg
    CO2 Neto (Grid - Reducido):           0 kg

  ENERGIA:
    Solar Aprovechado:            8,292,514 kWh
    EV Cargado:                     301,207 kWh
    Grid Import:                  7,433,072 kWh

  FLOTA MOVILIDAD:
    Motos cargadas (max):                20 / 112 (2,685 diarias)
    Mototaxis cargados (max):             8 / 16 (388 diarias)

  [OK] M├üXIMO SIMULT├üNEO DE VEH├ìCULOS POR NIVEL DE CARGA (SOC):
    Motos:    10%- 0 veh | 20%- 0 veh | 30%- 0 veh | 50%- 0 veh | 70%- 0 veh | 80%- 0 veh | 100%- 0 veh
    Taxis:    10%- 0 veh | 20%- 0 veh | 30%- 0 veh | 50%- 0 veh | 70%- 0 veh | 80%- 0 veh | 100%- 0 veh

  BESS ALMACENAMIENTO:
    Descarga:                       677,836 kWh
    Carga:                          790,716 kWh
  ================================================================

    Steps:   9,000 | Ep:  1 | Progreso:   2.7% | CO2_grid:   95,111 kg | CO2_evitado:   98,207 kg
    Steps:  10,000 | Ep:  1 | Progreso:  14.2% | CO2_grid:  500,811 kg | CO2_evitado:  504,757 kg
    ÔÜá´©Å  [PPO CRITICAL] KL alto (0.0770) + Clip alto (30.8%) (count: 2)
        ÔåÆ PROBLEMA SEVERO: Updates demasiado agresivos
        ÔåÆ Acci├│n: Reducir LR, reducir n_epochs, o aumentar batch_size
    Steps:  11,000 | Ep:  1 | Progreso:  25.6% | CO2_grid:  879,291 kg | CO2_evitado:  912,085 kg
    Steps:  12,000 | Ep:  1 | Progreso:  37.0% | CO2_grid: 1,253,453 kg | CO2_evitado: 1,330,482 kg
    [PPO INFO] Entropy baseline establecido: 55.4732
    Steps:  13,000 | Ep:  1 | Progreso:  48.4% | CO2_grid: 1,593,135 kg | CO2_evitado: 1,725,297 kg
    Steps:  14,000 | Ep:  1 | Progreso:  59.8% | CO2_grid: 1,958,921 kg | CO2_evitado: 2,139,980 kg
    Steps:  15,000 | Ep:  1 | Progreso:  71.2% | CO2_grid: 2,329,631 kg | CO2_evitado: 2,591,952 kg
    Steps:  16,000 | Ep:  1 | Progreso:  82.6% | CO2_grid: 2,715,998 kg | CO2_evitado: 3,057,422 kg
    [PPO] Step  16,384:
           KL: 0.0502 | Clip%: 29.9% | Entropy: 55.649
           Policy L: -0.0483 | Value L: 0.6244 | Expl.Var: -0.271
    ÔÜá´©Å  [PPO WARNING] KL alto: 0.0502 > 0.03 (count: 2)
    Steps:  17,000 | Ep:  1 | Progreso:  94.1% | CO2_grid: 3,108,282 kg | CO2_evitado: 3,502,966 kg

  ================================================================
  EPISODIO 2 COMPLETADO
  ================================================================
    Reward Total (acumulado):      6,801.39

  CO2 CONTABILIDAD (SIN DOUBLE-COUNTING):
    Grid Import CO2:              3,329,762 kg
    - Reducido Indirecto:         2,995,464 kg (solar/BESS -> grid avoidance)
    - Reducido Directo:             728,978 kg (EV renewable -> avoid combustion)
    = Reducci├│n Total:            3,724,442 kg
    CO2 Neto (Grid - Reducido):           0 kg

  ENERGIA:
    Solar Aprovechado:            8,292,514 kWh
    EV Cargado:                     322,361 kWh
    Grid Import:                  7,365,095 kWh

  FLOTA MOVILIDAD:
    Motos cargadas (max):                22 / 112 (2,685 diarias)
    Mototaxis cargados (max):             8 / 16 (388 diarias)

  [OK] M├üXIMO SIMULT├üNEO DE VEH├ìCULOS POR NIVEL DE CARGA (SOC):
    Motos:    10%- 0 veh | 20%- 0 veh | 30%- 0 veh | 50%- 0 veh | 70%- 0 veh | 80%- 0 veh | 100%- 0 veh
    Taxis:    10%-0.0 veh | 20%-0.0 veh | 30%-0.0 veh | 50%-0.0 veh | 70%-0.0 veh | 80%-0.0 veh | 100%- 0 veh

  BESS ALMACENAMIENTO:
    Descarga:                       677,836 kWh
    Carga:                          790,716 kWh
  ================================================================

    Steps:  18,000 | Ep:  2 | Progreso:   5.5% | CO2_grid:  186,765 kg | CO2_evitado:  198,154 kg
    ÔÜá´©Å  [PPO CRITICAL] KL alto (0.0738) + Clip alto (37.3%) (count: 3)
        ÔåÆ PROBLEMA SEVERO: Updates demasiado agresivos
        ÔåÆ Acci├│n: Reducir LR, reducir n_epochs, o aumentar batch_size
    Steps:  19,000 | Ep:  2 | Progreso:  16.9% | CO2_grid:  593,304 kg | CO2_evitado:  612,722 kg
    Steps:  20,000 | Ep:  2 | Progreso:  28.3% | CO2_grid:  961,232 kg | CO2_evitado: 1,030,450 kg
    ÔÜá´©Å  [PPO WARNING] KL alto: 0.0456 > 0.03 (count: 3)
    Steps:  21,000 | Ep:  2 | Progreso:  39.7% | CO2_grid: 1,333,039 kg | CO2_evitado: 1,454,207 kg
    Steps:  22,000 | Ep:  2 | Progreso:  51.1% | CO2_grid: 1,670,110 kg | CO2_evitado: 1,869,140 kg
    Steps:  23,000 | Ep:  2 | Progreso:  62.6% | CO2_grid: 2,023,214 kg | CO2_evitado: 2,306,383 kg
    Steps:  24,000 | Ep:  2 | Progreso:  74.0% | CO2_grid: 2,411,552 kg | CO2_evitado: 2,783,588 kg
    [PPO] Step  24,576:
           KL: 0.0631 | Clip%: 34.9% | Entropy: 55.806
           Policy L: -0.0486 | Value L: 0.2491 | Expl.Var: 0.156
    ÔÜá´©Å  [PPO CRITICAL] KL alto (0.0631) + Clip alto (34.9%) (count: 4)
        ÔåÆ PROBLEMA SEVERO: Updates demasiado agresivos
        ÔåÆ Acci├│n: Reducir LR, reducir n_epochs, o aumentar batch_size
    Steps:  25,000 | Ep:  2 | Progreso:  85.4% | CO2_grid: 2,800,090 kg | CO2_evitado: 3,261,708 kg
    Steps:  26,000 | Ep:  2 | Progreso:  96.8% | CO2_grid: 3,189,999 kg | CO2_evitado: 3,731,956 kg

  ================================================================
  EPISODIO 3 COMPLETADO
  ================================================================
    Reward Total (acumulado):      6,215.96

  CO2 CONTABILIDAD (SIN DOUBLE-COUNTING):
    Grid Import CO2:              3,317,440 kg
    - Reducido Indirecto:         3,009,196 kg (solar/BESS -> grid avoidance)
    - Reducido Directo:             837,351 kg (EV renewable -> avoid combustion)
    = Reducci├│n Total:            3,846,548 kg
    CO2 Neto (Grid - Reducido):           0 kg

  ENERGIA:
    Solar Aprovechado:            8,292,514 kWh
    EV Cargado:                     370,285 kWh
    Grid Import:                  7,337,848 kWh

  FLOTA MOVILIDAD:
    Motos cargadas (max):                23 / 112 (2,685 diarias)
    Mototaxis cargados (max):             8 / 16 (388 diarias)

  [OK] M├üXIMO SIMULT├üNEO DE VEH├ìCULOS POR NIVEL DE CARGA (SOC):
    Motos:    10%- 0 veh | 20%- 0 veh | 30%- 0 veh | 50%- 0 veh | 70%- 0 veh | 80%- 0 veh | 100%- 0 veh
    Taxis:    10%-0.0 veh | 20%-0.0 veh | 30%-0.0 veh | 50%-0.0 veh | 70%-0.0 veh | 80%-0.0 veh | 100%- 0 veh

  BESS ALMACENAMIENTO:
    Descarga:                       677,836 kWh
    Carga:                          790,716 kWh
  ================================================================

    ÔÜá´©Å  [PPO CRITICAL] KL alto (0.0658) + Clip alto (33.3%) (count: 5)
        ÔåÆ PROBLEMA SEVERO: Updates demasiado agresivos
        ÔåÆ Acci├│n: Reducir LR, reducir n_epochs, o aumentar batch_size
    ­ƒöº [AUTO-CORRECTION] LR reduction #1 suggested (reason: combined_kl_clip)
        ÔåÆ Recomendaci├│n: Reiniciar con LR reducido (actual ├ù 0.5)
    Steps:  27,000 | Ep:  3 | Progreso:   8.2% | CO2_grid:  283,787 kg | CO2_evitado:  305,001 kg
    Steps:  28,000 | Ep:  3 | Progreso:  19.6% | CO2_grid:  681,428 kg | CO2_evitado:  720,931 kg
    ­ƒöº [AUTO-CORRECTION] LR reduction #2 suggested (reason: combined_kl_clip)
        ÔåÆ Recomendaci├│n: Reiniciar con LR reducido (actual ├ù 0.5)
    Steps:  29,000 | Ep:  3 | Progreso:  31.1% | CO2_grid: 1,059,647 kg | CO2_evitado: 1,152,724 kg
    Steps:  30,000 | Ep:  3 | Progreso:  42.5% | CO2_grid: 1,418,174 kg | CO2_evitado: 1,587,023 kg
    Steps:  31,000 | Ep:  3 | Progreso:  53.9% | CO2_grid: 1,765,840 kg | CO2_evitado: 2,026,094 kg
    Steps:  32,000 | Ep:  3 | Progreso:  65.3% | CO2_grid: 2,134,965 kg | CO2_evitado: 2,485,774 kg
    [PPO] Step  32,768:
           KL: 0.0550 | Clip%: 32.1% | Entropy: 55.911
           Policy L: -0.0432 | Value L: 0.1245 | Expl.Var: 0.259
    ­ƒöº [AUTO-CORRECTION] LR reduction #3 suggested (reason: combined_kl_clip)
        ÔåÆ Recomendaci├│n: Reiniciar con LR reducido (actual ├ù 0.5)
    Steps:  33,000 | Ep:  3 | Progreso:  76.7% | CO2_grid: 2,527,903 kg | CO2_evitado: 2,980,674 kg
    Steps:  34,000 | Ep:  3 | Progreso:  88.1% | CO2_grid: 2,933,471 kg | CO2_evitado: 3,467,290 kg
    Steps:  35,000 | Ep:  3 | Progreso:  99.5% | CO2_grid: 3,348,860 kg | CO2_evitado: 3,933,101 kg

  ================================================================
  EPISODIO 4 COMPLETADO
  ================================================================
    Reward Total (acumulado):      5,547.98

  CO2 CONTABILIDAD (SIN DOUBLE-COUNTING):
    Grid Import CO2:              3,366,499 kg
    - Reducido Indirecto:         2,996,428 kg (solar/BESS -> grid avoidance)
    - Reducido Directo:             955,946 kg (EV renewable -> avoid combustion)
    = Reducci├│n Total:            3,952,374 kg
    CO2 Neto (Grid - Reducido):           0 kg

  ENERGIA:
    Solar Aprovechado:            8,292,514 kWh
    EV Cargado:                     422,729 kWh
    Grid Import:                  7,446,382 kWh

  FLOTA MOVILIDAD:
    Motos cargadas (max):                25 / 112 (2,685 diarias)
    Mototaxis cargados (max):             8 / 16 (388 diarias)

  [OK] M├üXIMO SIMULT├üNEO DE VEH├ìCULOS POR NIVEL DE CARGA (SOC):
    Motos:    10%- 0 veh | 20%- 0 veh | 30%- 0 veh | 50%- 0 veh | 70%- 0 veh | 80%- 0 veh | 100%- 0 veh
    Taxis:    10%-0.0 veh | 20%-0.0 veh | 30%-0.0 veh | 50%-0.0 veh | 70%-0.0 veh | 80%-0.0 veh | 100%- 0 veh

  BESS ALMACENAMIENTO:
    Descarga:                       677,836 kWh
    Carga:                          790,716 kWh
  ================================================================

    Steps:  36,000 | Ep:  4 | Progreso:  11.0% | CO2_grid:  383,599 kg | CO2_evitado:  416,847 kg
    ÔÜá´©Å  [PPO WARNING] Explained variance negativa: -0.565 (total: 10)
    Steps:  37,000 | Ep:  4 | Progreso:  22.4% | CO2_grid:  768,223 kg | CO2_evitado:  851,820 kg
    Steps:  38,000 | Ep:  4 | Progreso:  33.8% | CO2_grid: 1,144,693 kg | CO2_evitado: 1,303,262 kg
    ÔÜá´©Å  [PPO CRITICAL] KL alto (0.0557) + Clip alto (30.6%) (count: 10)
        ÔåÆ PROBLEMA SEVERO: Updates demasiado agresivos
        ÔåÆ Acci├│n: Reducir LR, reducir n_epochs, o aumentar batch_size
    Steps:  39,000 | Ep:  4 | Progreso:  45.2% | CO2_grid: 1,498,060 kg | CO2_evitado: 1,745,065 kg
    Steps:  40,000 | Ep:  4 | Progreso:  56.6% | CO2_grid: 1,853,756 kg | CO2_evitado: 2,206,914 kg
    [PPO] Step  40,960:
           KL: 0.0737 | Clip%: 27.7% | Entropy: 55.970
           Policy L: -0.0418 | Value L: 0.0795 | Expl.Var: 0.543
    Steps:  41,000 | Ep:  4 | Progreso:  68.0% | CO2_grid: 2,224,161 kg | CO2_evitado: 2,691,459 kg
    Steps:  42,000 | Ep:  4 | Progreso:  79.5% | CO2_grid: 2,627,588 kg | CO2_evitado: 3,208,859 kg
    Steps:  43,000 | Ep:  4 | Progreso:  90.9% | CO2_grid: 3,029,668 kg | CO2_evitado: 3,713,536 kg

  ================================================================
  EPISODIO 5 COMPLETADO
  ================================================================
    Reward Total (acumulado):      5,244.06

  CO2 CONTABILIDAD (SIN DOUBLE-COUNTING):
    Grid Import CO2:              3,370,282 kg
    - Reducido Indirecto:         3,016,902 kg (solar/BESS -> grid avoidance)
    - Reducido Directo:           1,084,732 kg (EV renewable -> avoid combustion)
    = Reducci├│n Total:            4,101,634 kg
    CO2 Neto (Grid - Reducido):           0 kg

  ENERGIA:
    Solar Aprovechado:            8,292,514 kWh
    EV Cargado:                     479,679 kWh
    Grid Import:                  7,454,742 kWh

  FLOTA MOVILIDAD:
    Motos cargadas (max):                26 / 112 (2,685 diarias)
    Mototaxis cargados (max):             8 / 16 (388 diarias)

  [OK] M├üXIMO SIMULT├üNEO DE VEH├ìCULOS POR NIVEL DE CARGA (SOC):
    Motos:    10%- 0 veh | 20%- 0 veh | 30%- 0 veh | 50%- 0 veh | 70%- 0 veh | 80%- 0 veh | 100%- 0 veh
    Taxis:    10%-0.0 veh | 20%-0.0 veh | 30%-0.0 veh | 50%-0.0 veh | 70%-0.0 veh | 80%-0.0 veh | 100%- 0 veh

  BESS ALMACENAMIENTO:
    Descarga:                       677,836 kWh
    Carga:                          790,716 kWh
  ================================================================

    Steps:  44,000 | Ep:  5 | Progreso:   2.3% | CO2_grid:   75,647 kg | CO2_evitado:   86,151 kg
    Steps:  45,000 | Ep:  5 | Progreso:  13.7% | CO2_grid:  488,106 kg | CO2_evitado:  529,578 kg
    Steps:  46,000 | Ep:  5 | Progreso:  25.1% | CO2_grid:  856,394 kg | CO2_evitado:  993,765 kg
    Steps:  47,000 | Ep:  5 | Progreso:  36.5% | CO2_grid: 1,237,258 kg | CO2_evitado: 1,459,168 kg
    Steps:  48,000 | Ep:  5 | Progreso:  47.9% | CO2_grid: 1,593,352 kg | CO2_evitado: 1,911,174 kg
    Steps:  49,000 | Ep:  5 | Progreso:  59.4% | CO2_grid: 1,953,737 kg | CO2_evitado: 2,396,926 kg
    [PPO] Step  49,152:
           KL: 0.0555 | Clip%: 31.0% | Entropy: 55.987
           Policy L: -0.0422 | Value L: 0.0578 | Expl.Var: 0.684
    Steps:  50,000 | Ep:  5 | Progreso:  70.8% | CO2_grid: 2,336,736 kg | CO2_evitado: 2,906,524 kg
    Steps:  51,000 | Ep:  5 | Progreso:  82.2% | CO2_grid: 2,738,462 kg | CO2_evitado: 3,443,348 kg
    Steps:  52,000 | Ep:  5 | Progreso:  93.6% | CO2_grid: 3,143,683 kg | CO2_evitado: 3,960,706 kg

  ================================================================
  EPISODIO 6 COMPLETADO
  ================================================================
    Reward Total (acumulado):      4,986.15

  CO2 CONTABILIDAD (SIN DOUBLE-COUNTING):
    Grid Import CO2:              3,386,473 kg
    - Reducido Indirecto:         3,022,472 kg (solar/BESS -> grid avoidance)
    - Reducido Directo:           1,208,965 kg (EV renewable -> avoid combustion)
    = Reducci├│n Total:            4,231,437 kg
    CO2 Neto (Grid - Reducido):           0 kg

  ENERGIA:
    Solar Aprovechado:            8,292,514 kWh
    EV Cargado:                     534,617 kWh
    Grid Import:                  7,490,532 kWh

  FLOTA MOVILIDAD:
    Motos cargadas (max):                28 / 112 (2,685 diarias)
    Mototaxis cargados (max):             8 / 16 (388 diarias)

  [OK] M├üXIMO SIMULT├üNEO DE VEH├ìCULOS POR NIVEL DE CARGA (SOC):
    Motos:    10%- 0 veh | 20%- 0 veh | 30%- 0 veh | 50%- 0 veh | 70%- 0 veh | 80%- 0 veh | 100%- 0 veh
    Taxis:    10%-0.0 veh | 20%-0.0 veh | 30%-0.0 veh | 50%-0.0 veh | 70%-0.0 veh | 80%-0.0 veh | 100%- 0 veh

  BESS ALMACENAMIENTO:
    Descarga:                       677,836 kWh
    Carga:                          790,716 kWh
  ================================================================

    Steps:  53,000 | Ep:  6 | Progreso:   5.0% | CO2_grid:  177,070 kg | CO2_evitado:  197,488 kg
    Steps:  54,000 | Ep:  6 | Progreso:  16.4% | CO2_grid:  598,822 kg | CO2_evitado:  659,704 kg
    Steps:  55,000 | Ep:  6 | Progreso:  27.9% | CO2_grid:  964,785 kg | CO2_evitado: 1,133,265 kg
    Steps:  56,000 | Ep:  6 | Progreso:  39.3% | CO2_grid: 1,349,877 kg | CO2_evitado: 1,609,476 kg
    Steps:  57,000 | Ep:  6 | Progreso:  50.7% | CO2_grid: 1,712,541 kg | CO2_evitado: 2,077,385 kg
    [PPO] Step  57,344:
           KL: 0.0385 | Clip%: 30.0% | Entropy: 55.984
           Policy L: -0.0419 | Value L: 0.0464 | Expl.Var: 0.659
    Steps:  58,000 | Ep:  6 | Progreso:  62.1% | CO2_grid: 2,069,484 kg | CO2_evitado: 2,582,669 kg
    Steps:  59,000 | Ep:  6 | Progreso:  73.5% | CO2_grid: 2,476,526 kg | CO2_evitado: 3,110,100 kg
    Steps:  60,000 | Ep:  6 | Progreso:  84.9% | CO2_grid: 2,882,032 kg | CO2_evitado: 3,649,681 kg
    Steps:  61,000 | Ep:  6 | Progreso:  96.3% | CO2_grid: 3,286,152 kg | CO2_evitado: 4,182,837 kg

  ================================================================
  EPISODIO 7 COMPLETADO
  ================================================================
    Reward Total (acumulado):      4,781.42

  CO2 CONTABILIDAD (SIN DOUBLE-COUNTING):
    Grid Import CO2:              3,438,650 kg
    - Reducido Indirecto:         3,018,539 kg (solar/BESS -> grid avoidance)
    - Reducido Directo:           1,311,205 kg (EV renewable -> avoid combustion)
    = Reducci├│n Total:            4,329,744 kg
    CO2 Neto (Grid - Reducido):           0 kg

  ENERGIA:
    Solar Aprovechado:            8,292,514 kWh
    EV Cargado:                     579,828 kWh
    Grid Import:                  7,605,961 kWh

  FLOTA MOVILIDAD:
    Motos cargadas (max):                29 / 112 (2,685 diarias)
    Mototaxis cargados (max):             8 / 16 (388 diarias)

  [OK] M├üXIMO SIMULT├üNEO DE VEH├ìCULOS POR NIVEL DE CARGA (SOC):
    Motos:    10%- 0 veh | 20%- 0 veh | 30%- 0 veh | 50%- 0 veh | 70%- 0 veh | 80%- 0 veh | 100%- 0 veh
    Taxis:    10%-0.0 veh | 20%-0.0 veh | 30%-0.0 veh | 50%-0.0 veh | 70%-0.0 veh | 80%-0.0 veh | 100%- 0 veh

  BESS ALMACENAMIENTO:
    Descarga:                       677,836 kWh
    Carga:                          790,716 kWh
  ================================================================

    Steps:  62,000 | Ep:  7 | Progreso:   7.8% | CO2_grid:  277,034 kg | CO2_evitado:  317,178 kg
    Steps:  63,000 | Ep:  7 | Progreso:  19.2% | CO2_grid:  692,150 kg | CO2_evitado:  786,712 kg
    Steps:  64,000 | Ep:  7 | Progreso:  30.6% | CO2_grid: 1,076,001 kg | CO2_evitado: 1,279,121 kg
    Steps:  65,000 | Ep:  7 | Progreso:  42.0% | CO2_grid: 1,445,168 kg | CO2_evitado: 1,762,641 kg
    [PPO] Step  65,536:
           KL: 0.0313 | Clip%: 27.5% | Entropy: 55.987
           Policy L: -0.0394 | Value L: 0.0365 | Expl.Var: 0.552
    ÔÜá´©Å  [PPO WARNING] KL alto: 0.0313 > 0.03 (count: 10)
    Steps:  66,000 | Ep:  7 | Progreso:  53.4% | CO2_grid: 1,812,456 kg | CO2_evitado: 2,254,542 kg
    Steps:  67,000 | Ep:  7 | Progreso:  64.8% | CO2_grid: 2,181,028 kg | CO2_evitado: 2,773,700 kg
    Steps:  68,000 | Ep:  7 | Progreso:  76.3% | CO2_grid: 2,588,155 kg | CO2_evitado: 3,320,236 kg
    Steps:  69,000 | Ep:  7 | Progreso:  87.7% | CO2_grid: 2,998,655 kg | CO2_evitado: 3,863,538 kg
    Steps:  70,000 | Ep:  7 | Progreso:  99.1% | CO2_grid: 3,418,394 kg | CO2_evitado: 4,384,548 kg

  ================================================================
  EPISODIO 8 COMPLETADO
  ================================================================
    Reward Total (acumulado):      4,687.22

  CO2 CONTABILIDAD (SIN DOUBLE-COUNTING):
    Grid Import CO2:              3,455,263 kg
    - Reducido Indirecto:         3,022,375 kg (solar/BESS -> grid avoidance)
    - Reducido Directo:           1,398,828 kg (EV renewable -> avoid combustion)
    = Reducci├│n Total:            4,421,202 kg
    CO2 Neto (Grid - Reducido):           0 kg

  ENERGIA:
    Solar Aprovechado:            8,292,514 kWh
    EV Cargado:                     618,576 kWh
    Grid Import:                  7,642,692 kWh

  FLOTA MOVILIDAD:
    Motos cargadas (max):                29 / 112 (2,685 diarias)
    Mototaxis cargados (max):             8 / 16 (388 diarias)

  [OK] M├üXIMO SIMULT├üNEO DE VEH├ìCULOS POR NIVEL DE CARGA (SOC):
    Motos:    10%- 0 veh | 20%- 0 veh | 30%- 0 veh | 50%- 0 veh | 70%- 0 veh | 80%- 0 veh | 100%- 0 veh
    Taxis:    10%-0.0 veh | 20%-0.0 veh | 30%-0.0 veh | 50%-0.0 veh | 70%-0.0 veh | 80%-0.0 veh | 100%- 0 veh

  BESS ALMACENAMIENTO:
    Descarga:                       677,836 kWh
    Carga:                          790,716 kWh
  ================================================================

    Steps:  71,000 | Ep:  8 | Progreso:  10.5% | CO2_grid:  372,511 kg | CO2_evitado:  440,295 kg
    Steps:  72,000 | Ep:  8 | Progreso:  21.9% | CO2_grid:  773,308 kg | CO2_evitado:  922,882 kg
    Steps:  73,000 | Ep:  8 | Progreso:  33.3% | CO2_grid: 1,159,151 kg | CO2_evitado: 1,428,114 kg
    [PPO] Step  73,728:
           KL: 0.0124 | Clip%: 12.4% | Entropy: 55.983
           Policy L: -0.0212 | Value L: 0.0349 | Expl.Var: 0.730
    Steps:  74,000 | Ep:  8 | Progreso:  44.7% | CO2_grid: 1,523,998 kg | CO2_evitado: 1,913,195 kg
    Steps:  75,000 | Ep:  8 | Progreso:  56.2% | CO2_grid: 1,894,614 kg | CO2_evitado: 2,418,812 kg
    Steps:  76,000 | Ep:  8 | Progreso:  67.6% | CO2_grid: 2,275,308 kg | CO2_evitado: 2,949,912 kg
    Steps:  77,000 | Ep:  8 | Progreso:  79.0% | CO2_grid: 2,680,505 kg | CO2_evitado: 3,504,829 kg
    Steps:  78,000 | Ep:  8 | Progreso:  90.4% | CO2_grid: 3,100,072 kg | CO2_evitado: 4,045,178 kg

  ================================================================
  EPISODIO 9 COMPLETADO
  ================================================================
    Reward Total (acumulado):      4,615.92

  CO2 CONTABILIDAD (SIN DOUBLE-COUNTING):
    Grid Import CO2:              3,455,956 kg
    - Reducido Indirecto:         3,026,412 kg (solar/BESS -> grid avoidance)
    - Reducido Directo:           1,459,638 kg (EV renewable -> avoid combustion)
    = Reducci├│n Total:            4,486,050 kg
    CO2 Neto (Grid - Reducido):           0 kg

  ENERGIA:
    Solar Aprovechado:            8,292,514 kWh
    EV Cargado:                     645,467 kWh
    Grid Import:                  7,644,222 kWh

  FLOTA MOVILIDAD:
    Motos cargadas (max):                29 / 112 (2,685 diarias)
    Mototaxis cargados (max):             8 / 16 (388 diarias)

  [OK] M├üXIMO SIMULT├üNEO DE VEH├ìCULOS POR NIVEL DE CARGA (SOC):
    Motos:    10%- 0 veh | 20%- 0 veh | 30%- 0 veh | 50%- 0 veh | 70%- 0 veh | 80%- 0 veh | 100%- 0 veh
    Taxis:    10%-0.0 veh | 20%-0.0 veh | 30%-0.0 veh | 50%-0.0 veh | 70%-0.0 veh | 80%-0.0 veh | 100%- 0 veh

  BESS ALMACENAMIENTO:
    Descarga:                       677,836 kWh
    Carga:                          790,716 kWh
  ================================================================

    Steps:  79,000 | Ep:  9 | Progreso:   1.8% | CO2_grid:   62,751 kg | CO2_evitado:   78,015 kg
    Steps:  80,000 | Ep:  9 | Progreso:  13.2% | CO2_grid:  488,534 kg | CO2_evitado:  558,119 kg
    Steps:  81,000 | Ep:  9 | Progreso:  24.7% | CO2_grid:  874,540 kg | CO2_evitado: 1,060,470 kg
    [PPO] Step  81,920:
           KL: 0.0120 | Clip%: 7.9% | Entropy: 55.980
           Policy L: -0.0126 | Value L: 0.0314 | Expl.Var: 0.765
    Steps:  82,000 | Ep:  9 | Progreso:  36.1% | CO2_grid: 1,261,562 kg | CO2_evitado: 1,568,998 kg
    Steps:  83,000 | Ep:  9 | Progreso:  47.5% | CO2_grid: 1,625,028 kg | CO2_evitado: 2,051,048 kg
    Steps:  84,000 | Ep:  9 | Progreso:  58.9% | CO2_grid: 1,993,940 kg | CO2_evitado: 2,571,205 kg
    Steps:  85,000 | Ep:  9 | Progreso:  70.3% | CO2_grid: 2,378,151 kg | CO2_evitado: 3,115,360 kg
    Steps:  86,000 | Ep:  9 | Progreso:  81.7% | CO2_grid: 2,797,803 kg | CO2_evitado: 3,670,294 kg
    Steps:  87,000 | Ep:  9 | Progreso:  93.2% | CO2_grid: 3,212,660 kg | CO2_evitado: 4,215,163 kg

  ================================================================
  EPISODIO 10 COMPLETADO
  ================================================================
    Reward Total (acumulado):      4,577.46

  CO2 CONTABILIDAD (SIN DOUBLE-COUNTING):
    Grid Import CO2:              3,475,079 kg
    - Reducido Indirecto:         3,021,171 kg (solar/BESS -> grid avoidance)
    - Reducido Directo:           1,500,568 kg (EV renewable -> avoid combustion)
    = Reducci├│n Total:            4,521,740 kg
    CO2 Neto (Grid - Reducido):           0 kg

  ENERGIA:
    Solar Aprovechado:            8,292,514 kWh
    EV Cargado:                     663,566 kWh
    Grid Import:                  7,686,521 kWh

  FLOTA MOVILIDAD:
    Motos cargadas (max):                30 / 112 (2,685 diarias)
    Mototaxis cargados (max):             8 / 16 (388 diarias)

  [OK] M├üXIMO SIMULT├üNEO DE VEH├ìCULOS POR NIVEL DE CARGA (SOC):
    Motos:    10%- 0 veh | 20%- 0 veh | 30%- 0 veh | 50%- 0 veh | 70%- 0 veh | 80%- 0 veh | 100%- 0 veh
    Taxis:    10%-0.0 veh | 20%-0.0 veh | 30%-0.0 veh | 50%-0.0 veh | 70%-0.0 veh | 80%-0.0 veh | 100%- 0 veh

  BESS ALMACENAMIENTO:
    Descarga:                       677,836 kWh
    Carga:                          790,716 kWh
  ================================================================

    Steps:  88,000 | Ep: 10 | Progreso:   4.6% | CO2_grid:  159,112 kg | CO2_evitado:  199,078 kg

  ================================================================
  RESUMEN M├ëTRICAS PPO
  ================================================================
    KL divergence:        mean=0.0362, max=0.0770
    Clip fraction:        mean=22.9%, max=38.2%
    Entropy:              mean=55.869, final=55.980
    Explained variance:   mean=-0.166, final=-4.260
  ================================================================

================================================================================
RESUMEN DE PROBLEMAS DETECTADOS (PPO)
================================================================================
  Total de eventos problem├íticos: 42

  ÔØî CR├ìTICO - KL + Clip altos simult├íneamente: 14 veces
      ÔåÆ Soluci├│n: Reducir learning_rate a 1e-4, reducir n_epochs a 5
  ÔÜá´©Å  KL divergence alto: 10 veces
  ÔÜá´©Å  Explained variance negativa: 18 veces

  ­ƒöº Correcciones sugeridas durante entrenamiento:
      - LR reduction #1 suggested (reason: combined_kl_clip)
      - LR reduction #2 suggested (reason: combined_kl_clip)
      - LR reduction #3 suggested (reason: combined_kl_clip)

  RECOMENDACIONES PARA SIGUIENTE ENTRENAMIENTO:
    1. learning_rate: 3e-4 ÔåÆ 1e-4 (reducir agresividad)
================================================================================

    [GRAPH] KL Divergence: outputs\ppo_training\ppo_kl_divergence.png
    [GRAPH] Clip Fraction: outputs\ppo_training\ppo_clip_fraction.png
    [GRAPH] Entropy: outputs\ppo_training\ppo_entropy.png
    [GRAPH] Value Metrics: outputs\ppo_training\ppo_value_metrics.png
    [GRAPH] Dashboard: outputs\ppo_training\ppo_dashboard.png
  [OK] 5 gr├íficas PPO generadas en: outputs\ppo_training
 100% ------------------------- 88,064/87,600  [ 0:02:22 < 0:00:00 , 556 it/s ]
2026-02-14 08:37:17,943 | __main__ | INFO | Entrenamiento exitoso: 2.4 min (speed: 608 steps/s)
2026-02-14 08:37:17,943 | __main__ | INFO | Modelo guardado: checkpoints\PPO\ppo_final.zip

Entrenamiento completado: 2.4 min (608 steps/s)

[PASO 6] VALIDACION - 10 EPISODIOS DETERMINISICOS
--------------------------------------------------------------------------------
2026-02-14 08:37:26,755 | __main__ | INFO |   Episodio 1/10: 8760 steps | R=  4784.1 | CO2=   4750577 kg | Solar=   8292514 kWh
2026-02-14 08:37:35,224 | __main__ | INFO |   Episodio 2/10: 8760 steps | R=  4693.7 | CO2=   4750088 kg | Solar=   8292514 kWh
2026-02-14 08:37:43,903 | __main__ | INFO |   Episodio 3/10: 8760 steps | R=  4661.7 | CO2=   4749673 kg | Solar=   8292514 kWh
2026-02-14 08:37:52,714 | __main__ | INFO |   Episodio 4/10: 8760 steps | R=  4664.0 | CO2=   4749316 kg | Solar=   8292514 kWh
2026-02-14 08:38:01,670 | __main__ | INFO |   Episodio 5/10: 8760 steps | R=  4687.7 | CO2=   4749006 kg | Solar=   8292514 kWh
2026-02-14 08:38:10,412 | __main__ | INFO |   Episodio 6/10: 8760 steps | R=  4725.6 | CO2=   4748735 kg | Solar=   8292514 kWh
2026-02-14 08:38:20,144 | __main__ | INFO |   Episodio 7/10: 8760 steps | R=  4772.9 | CO2=   4748495 kg | Solar=   8292514 kWh
2026-02-14 08:38:28,791 | __main__ | INFO |   Episodio 8/10: 8760 steps | R=  4826.9 | CO2=   4748281 kg | Solar=   8292514 kWh
2026-02-14 08:38:37,486 | __main__ | INFO |   Episodio 9/10: 8760 steps | R=  4885.6 | CO2=   4748090 kg | Solar=   8292514 kWh
2026-02-14 08:38:46,237 | __main__ | INFO |   Episodio 10/10: 8760 steps | R=  4947.5 | CO2=   4747918 kg | Solar=   8292514 kWh

================================================================================
RESULTADOS FINALES - ENTRENAMIENTO Y VALIDACION
================================================================================

ENTRENAMIENTO:
  Total timesteps: 87,600
  Duracion: 2.4 minutos (608 steps/s)
  Device: CUDA

VALIDACION (10 episodios):
  Reward promedio:             4764.97 ┬▒ 92.51
  CO2 evitado (kg):            4749018
  Solar aprovechado (kWh):       8292514
  Grid import (kWh):           8700285

  GUARDANDO ARCHIVOS DE SALIDA:
    [OK] outputs\ppo_training\result_ppo.json
    [OK] outputs\ppo_training\timeseries_ppo.csv (88,064 registros)
    [OK] outputs\ppo_training\trace_ppo.csv (88,064 registros)

2026-02-14 08:38:47,327 | __main__ | INFO | Archivos generados en: outputs\ppo_training
================================================================================
ENTRENAMIENTO PPO COMPLETADO EXITOSAMENTE
================================================================================

