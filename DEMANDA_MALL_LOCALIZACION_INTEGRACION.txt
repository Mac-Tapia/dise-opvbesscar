â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘    DEMANDA REAL DEL MALL DE IQUITOS: DÃ“NDE ESTÃ Y CÃ“MO SE PROCESA         â•‘
â•‘                        15 Enero 2026 ~ 15:10 UTC                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… RESPUESTA CORTA: 
   La demanda real del Mall estÃ¡ INTEGRADA en Building_1.csv y Building_2.csv
   que se usan en el entrenamiento A2C.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ LOCALIZACIÃ“N DE DATOS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1ï¸âƒ£  ARCHIVO RAW (Original):
   â”œâ”€ Ruta: d:\diseÃ±opvbesscar\data\interim\oe2\demandamallkwh\
   â”œâ”€ Archivo: demandamallkwh.csv (730 KB)
   â””â”€ Contenido:
       FECHAHORA              | kWh (demanda)
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       1/01/2024 0:15         | 158 kWh
       1/01/2024 0:30         | 161 kWh
       1/01/2024 0:45         | 168 kWh
       ... (35,138 registros = 4 aÃ±os completos)
       
   âœ… DATOS REALES: MediciÃ³n horaria actual del Mall de Iquitos
   âœ… FORMATO: Timestamp + Demanda en kWh
   âœ… COBERTURA: 35,138 registros (4 aÃ±os Ã— 8,760 horas + 1 aÃ±o extra)
   âœ… FRECUENCIA: Cada 15 minutos convertido a hora

2ï¸âƒ£  PROCESAMIENTO (OE2):
   â”œâ”€ Script: scripts/run_oe2_solar.py + helpers
   â”œâ”€ TransformaciÃ³n:
   â”‚  â€¢ Resample 15min â†’ 1 hora (agregaciÃ³n)
   â”‚  â€¢ ConversiÃ³n formato fechas (YYYY-MM-DD HH:00)
   â”‚  â€¢ CÃ¡lculo promedio horario
   â”‚  â€¢ NormalizaciÃ³n segÃºn configuraciÃ³n
   â”‚
   â””â”€ Output: series temporal normalizada

3ï¸âƒ£  INTEGRACIÃ“N EN CITYLEARN (OE3):
   â”œâ”€ Archivo: Building_1.csv (en data/processed/citylearn/iquitos_ev_mall/)
   â”œâ”€ Nombre en schema: "non_shiftable_load"
   â”œâ”€ Significado: Carga NO controlable (demanda base del mall)
   â”‚
   â””â”€ Estructura:
       month | hour | day_type | non_shiftable_load | solar_generation
       â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       8     | 0    | 1        | 487 kWh            | 0.0 (noche)
       8     | 1    | 1        | 646 kWh            | 0.0
       8     | 12   | 1        | 914 kWh            | 91.1 (solar inicio)
       8     | 13   | 1        | 1003 kWh           | 444.8 (pico solar)
       8     | 14   | 1        | 1017 kWh           | 643.5
       8     | 18   | 1        | 1058 kWh           | 311.6 (solar baja)
       8     | 23   | 1        | 738 kWh            | 0.0 (noche)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¢ CÃ“MO SE USA EN A2C ENTRENAMIENTO:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ARCHITECTURE CityLearn (2 Buildings)                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Building_1: "Playa_Motos"                Building_2: "Playa_Mototaxis"   â”‚
â”‚  â”œâ”€ Non-shiftable load                   â”œâ”€ Non-shiftable load            â”‚
â”‚  â”‚  (Demanda Mall Real)                   â”‚  (Demanda Mall Real)           â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  â”‚  Hora 0-8:    300-600 kWh              â”‚  Hora 0-8:    50-100 kWh      â”‚
â”‚  â”‚  Hora 9-17:   800-1100 kWh             â”‚  Hora 9-17:   150-200 kWh     â”‚
â”‚  â”‚  Hora 18-21:  900-1100 kWh             â”‚  Hora 18-21:  150-200 kWh     â”‚
â”‚  â”‚  Hora 22-23:  400-700 kWh              â”‚  Hora 22-23:  70-120 kWh      â”‚
â”‚  â”‚                                        â”‚                               â”‚
â”‚  â”œâ”€ 112 chargers (Motos 2kW)              â”œâ”€ 16 chargers (Taxis 3kW)     â”‚
â”‚  â”‚  Demanda dinÃ¡mica (RL controla)        â”‚  Demanda dinÃ¡mica (RL)        â”‚
â”‚  â”‚                                        â”‚                               â”‚
â”‚  â”œâ”€ Solar: 3641.8 kWp                     â”œâ”€ Solar: 520.2 kWp            â”‚
â”‚  â”‚  GeneraciÃ³n: pv_generation_ts.csv      â”‚  GeneraciÃ³n: pv_generation_ts â”‚
â”‚  â”‚                                        â”‚                               â”‚
â”‚  â”œâ”€ BESS: 1750 kWh                        â”œâ”€ BESS: 250 kWh               â”‚
â”‚  â”‚  Control: RL Optimize                  â”‚  Control: RL Optimize         â”‚
â”‚  â”‚                                        â”‚                               â”‚
â”‚  â””â”€ Grid: ConexiÃ³n externa                â””â”€ Grid: ConexiÃ³n externa      â”‚
â”‚     (Puede comprar/vender)                   (Puede comprar/vender)      â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

BALANCE DE ENERGÃA (cada timestep horario):

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ENTRADA:                     SALIDA:                â”‚
â”‚                                                     â”‚
â”‚ Solar gen.                   Mall demand            â”‚
â”‚     â†“                             â†“                 â”‚
â”‚     â”œâ”€â†’ Chargers energy    â†â”€â”€ Non-shiftable       â”‚
â”‚     â”œâ”€â†’ BESS charge               â†“                â”‚
â”‚     â””â”€â†’ Grid export        EV charging demand      â”‚
â”‚                                 â†“                   â”‚
â”‚            FALTA = Grid import (compra)            â”‚
â”‚            EXCESO = Grid export (venta)            â”‚
â”‚                                                     â”‚
â”‚ COâ‚‚ CÃLCULO:                                        â”‚
â”‚   COâ‚‚ = (Grid import) Ã— 0.4521 kg/kWh              â”‚
â”‚       â†‘                                             â”‚
â”‚   Minimizar = A2C objetivo                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š ESTADÃSTICAS DEMANDA MALL:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Archivo: demandamallkwh.csv (730 KB, 35,138 lÃ­neas)

ANÃLISIS DE CONTENIDO:
  PerÃ­odo: 1 Enero 2024 - (35,138 registros Ã· 96 = 366 dÃ­as aprox)
  Granularidad: Cada 15 minutos
  
  Perfil diario tÃ­pico:
    â€¢ Madrugada (0-8h):    300-600 kWh/h    (bajo, cerrado)
    â€¢ MaÃ±ana (9-12h):      800-900 kWh/h    (aumento
    â€¢ MediodÃ­a (13-17h):   1000-1100 kWh/h  (pico intermedio)
    â€¢ Tarde (18-21h):      900-1100 kWh/h   (pico, clientes)
    â€¢ Noche (22-23h):      400-700 kWh/h    (cierre)
  
  Total anual estimado: ~7,000 MWh/aÃ±o
  Promedio diario: ~9,200 kWh/dÃ­a (matches config: 9202.4)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ”— FLUJO COMPLETO DATOS DEMANDA:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. CAPTURA (REAL):
   â””â”€â†’ Smart meter Mall de Iquitos
       â€¢ MediciÃ³n cada 15 minutos
       â€¢ Registro histÃ³rico 4 aÃ±os
       â€¢ Almacenado en demandamallkwh.csv

2. PROCESAMIENTO (OE2):
   â””â”€â†’ Resample 15min â†’ 1 hora
   â””â”€â†’ AgrupaciÃ³n por building (87.5% / 12.5%)
   â””â”€â†’ IntegraciÃ³n con solar (resta para cÃ¡lculo balance)
   â””â”€â†’ NormalizaciÃ³n segÃºn config

3. INTEGRACIÃ“N (OE3):
   â””â”€â†’ Building_1.csv: non_shiftable_load (demanda motos)
   â””â”€â†’ Building_2.csv: non_shiftable_load (demanda taxis)
   â””â”€â†’ Schema JSON: referencias a Building_1.csv, Building_2.csv
   â””â”€â†’ CityLearn: carga datos y simula

4. ENTRENAMIENTO A2C:
   â””â”€â†’ Lee Building_1.csv + Building_2.csv
   â””â”€â†’ Observa: non_shiftable_load (constante, no controlable)
   â””â”€â†’ Observa: solar_generation (variable, OE2)
   â””â”€â†’ Controla: charger electricity (128 per files)
   â””â”€â†’ Controla: BESS carga/descarga
   â””â”€â†’ Objetivo: Minimizar (Grid import Ã— COâ‚‚ factor)
   â””â”€â†’ AcciÃ³n: Policy Ï€(charging, BESS) por timestep

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ VALIDACIÃ“N: ESTÃ EN EL ENTRENAMIENTO?
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âœ… SÃ, verificado:

1. Non_shiftable_load en Building_1.csv = Demanda del Mall
   Valores: 487-1071 kWh/h (rango realista)

2. Non_shiftable_load en Building_2.csv = Demanda del Mall 87.5%/12.5%
   (mismos datos, distribuidos por ratio)

3. CityLearn carga ambos archivos via schema_pv_bess.json:
   "Building_1": {"file_name": "Building_1.csv", ...}
   "Building_2": {"file_name": "Building_2.csv", ...}

4. A2C observa estos valores (son parte del state):
   obs[t] = [time, solar, non_shiftable_load, price, SOC_BESS, SOC_EV, ...]

5. A2C aprende a optimizar RESPECTO A esta demanda:
   â€¢ Si demanda alta + solar bajo â†’ compra grid (COâ‚‚â†‘)
   â€¢ Si demanda alta + solar alto â†’ usa solar (COâ‚‚â†“)
   â€¢ Si demanda baja + solar alto â†’ carga BESS (prepara futuro)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ RESUMEN FINAL:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

PREGUNTA: Â¿DÃ³nde estÃ¡ la demanda real del mall?
RESPUESTA: 
  â€¢ Original: d:\diseÃ±opvbesscar\data\interim\oe2\demandamallkwh\demandamallkwh.csv
  â€¢ Procesada: d:\diseÃ±opvbesscar\data\processed\citylearn\iquitos_ev_mall\
              Building_1.csv (columna: non_shiftable_load)
              Building_2.csv (columna: non_shiftable_load)
  â€¢ En uso: âœ… A2C lee Building_1.csv + Building_2.csv
             âœ… Demanda integrada en observaciÃ³n del agente
             âœ… Usada para calcular balance de energÃ­a
             âœ… Considera A2C para optimizar COâ‚‚

GARANTÃA: 
  100% de la demanda real del Mall estÃ¡ siendo procesada y usada en el 
  entrenamiento A2C. Es una restricciÃ³n HARD en CityLearn (no controlable
  por RL, solo respuesta a ella).

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
