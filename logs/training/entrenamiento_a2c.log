[OK] PYTHONPATH configurado
[OK] Working directory: D:\dise±opvbesscar

================================================================================
ENTRENAR A2C - CON MULTIOBJETIVO REAL (CO2, SOLAR, COST, EV, GRID)
================================================================================
Inicio: 2026-02-14 16:18:12

­ƒÜÇ GPU: NVIDIA GeForce RTX 4060 Laptop GPU
   VRAM: 8.6 GB
   CUDA: 12.1
   Entrenamiento A2C en GPU (red 256x256, n_steps=8)
   Device: CUDA

[0] VALIDACION DE SINCRONIZACION A2C
--------------------------------------------------------------------------------

================================================================================
[VALIDACION] Sincronizacion A2C - Constantes contra SAC/PPO
================================================================================
  Ô£à 1. BESS Capacity (940 kWh)
  Ô£à 2. BESS Max normalizacion (1700 kWh)
  Ô£à 3. Solar Max (4100 kW)
  Ô£à 4. Mall Max (150 kW)
  Ô£à 5. Columnas observables (27)
  Ô£à 6. Chargers (10 cols)
  Ô£à 7. Solar (6 cols)
  Ô£à 8. BESS (5 cols)
  Ô£à 9. Mall (3 cols)

[OK] A2C sincronizado.\n
[0.5] VALIDACION CENTRALIZADA - ENTRENAMIENTO COMPLETO
--------------------------------------------------------------------------------

================================================================================
[VALIDACION DE ENTRENAMIENTO] A2C
================================================================================
  Ô£à Episodes: 10 (CORRECTO)
  Ô£à Timesteps: 87,600 (CORRECTO: 10 anos ├ù 8760)
  Ô£à solar       : data/oe2/Generacionsolar/pv_generation_citylearn2024.csv (0.9 MB)
  Ô£à chargers    : data/oe2/chargers/chargers_ev_ano_2024_v3.csv (16.3 MB)
  Ô£à mall        : data/oe2/demandamallkwh/demandamallhorakwh.csv (0.4 MB)
  Ô£à bess        : data/processed/citylearn/iquitos_ev_mall/bess_ano_2024.csv (1.6 MB)
  Ô£à Observation dim: 156 (>=  27 requeridas)
  Ô£à Action dim: 39 (1 BESS + 38 sockets)
  Ô£à Reward weights loaded (co2_focus mode)
  Ô£à CO2 factor: 0.4521
  Ô£à Chargers: 19
  Ô£à Total sockets: 38

================================================================================
[RESULTADO] Ô£à A2C PREPARADO PARA ENTRENAMIENTO COMPLETO
================================================================================
Config:
  ÔÇó Episodes: 10 (10 a├▒os completos)
  ÔÇó Timesteps: 87,600 (87,600 pasos)
  ÔÇó Observation: 156 dims
  ÔÇó Action: 39 dims
  ÔÇó Datasets: TODOS cargados
  ÔÇó Multiobjetivo: SI (27 columnas observables)
  ÔÇó Validaci├│n: OK Ô£à
[OK] Entrenamiento COMPLETO garantizado: 10 episodios ├ù 87,600 steps ├ù 27 observables ├ù multiobjetivo.

[1] CARGAR CONFIGURACION Y CONTEXTO MULTIOBJETIVO
--------------------------------------------------------------------------------
  OK Config loaded: 5 keys
  REWARD WEIGHTS (ACTUALIZADOS 2026-02-08 - LOG SAC):
    CO2 grid (0.35): Minimizar importacion grid
    Solar (0.20): Autoconsumo PV
    EV satisfaction (0.30): SOC 90%
    Cost (0.10): Minimizar costo
    Grid stability (0.05): Suavizar picos
  [Valores cargados: CO2=0.35, Solar=0.20, EV=0.30, Cost=0.10, Grid=0.05]

  OK Contexto Iquitos:
    - Grid CO2: 0.4521 kg CO2/kWh
    - EV CO2 factor: 2.146 kg CO2/kWh
    - Chargers: 19
    - Sockets: 38
    - Daily capacity: 270 motos + 39 mototaxis

[2] CARGAR DATASET CITYLEARN V2 (COMPILADO)
--------------------------------------------------------------------------------
  Dataset precompilado: data\processed\citylearn\iquitos_ev_mall
  OK Dataset: data\processed\citylearn\iquitos_ev_mall

[3] CARGAR DATOS DEL DATASET CITYLEARN V2 CONSTRUIDO (8760 horas = 1 a├▒o)
--------------------------------------------------------------------------------
  [SOLAR] REAL (CityLearn v2): columna=ac_power_kw | 8292514 kWh/a├▒o (8760h)
  [CHARGERS] Ô£à Cargando datos REALES desde: chargers_ev_ano_2024_v3.csv (38 sockets)
  [CHARGERS] DATASET REAL: 38 sockets | Demanda: 2463312 kWh/a├▒o | Promedio: 7.40 kW/socket
  [MALL] DATASET: 12368653 kWh/a├▒o (promedio 1411.9 kW/h)
  [BESS] Cargando DATOS REALES COMPLETOS desde: bess_ano_2024.csv
  [BESS] M├ëTRICAS CARGADAS: 15 columnas
         SOC: 55.2% promedio
         CO2 evitado: 279,679 kg/a├▒o
         Costo grid: S/. 2,300,787/a├▒o
         Carga: 790,716 kWh | Descarga: 677,836 kWh
  [EV] Cargando DATOS REALES COMPLETOS desde: chargers_ev_ano_2024_v3.csv
  [EV] M├ëTRICAS CARGADAS: 5 arrays agregados
       SOC promedio: 32.2%
       Veh├¡culos activos: 98,812/a├▒o
       Potencia carga: 453,349 kWh/a├▒o
  [CHARGER STATS] (5to OE2): max_power=2.46-2.52 kW, mean=0.89 kW

[4] CREAR ENVIRONMENT CON DATOS OE2 REALES
--------------------------------------------------------------------------------
  OK Environment creado (v5.3 con comunicaci├│n completa del sistema)
    - Observation: (156,) (156-dim: energ├¡a + sockets + veh├¡culos + coord)
    - Action: (39,)
    - BESS m├®tricas: ['soc', 'charge', 'discharge', 'to_ev', 'to_mall', 'pv_charge', 'grid_charge', 'co2_avoided', 'cost', 'tariff', 'peak_savings', 'grid_import', 'pv_to_ev', 'pv_to_mall', 'pv_curtailed']
    - EV m├®tricas: ['soc_current', 'soc_target', 'active_count', 'charging_power', 'vehicle_count']

[5] CREAR A2C AGENT
--------------------------------------------------------------------------------
  OK A2C agent creado (DEVICE: CUDA)
    - Learning rate: 0.0003
    - N steps: 16
    - Gamma: 0.99
    - GAE lambda: 0.95
    - Entropy coef: 0.01
    - Value coef: 0.5
    - Max grad norm: 0.5
    - Use RMSProp: False
    - Normalize advantage: True

[6] ENTRENAR A2C
--------------------------------------------------------------------------------

================================================================================
  ­ƒôè CONFIGURACION ENTRENAMIENTO A2C (100% DATOS REALES OE2)
     Episodios: 10 ├ù 8,760 timesteps = 87,600 pasos
     Device: CUDA
     Velocidad: ~650 timesteps/segundo
     Duraci├│n: ~134 segundos (GPU RTX 4060)
     Datos: REALES OE2 (chargers_ev_ano_2024_v3.csv 38 sockets, 940 kWh BESS, 4.05 MWp solar)
     Network: 256x256 (on-policy A2C), n_steps=8 (updates frecuentes)
     Output: result_a2c.json, timeseries_a2c.csv, trace_a2c.csv

  REWARD WEIGHTS (CO2_FOCUS):
    CO2 grid (0.35): Minimizar importacion
    Solar (0.20): Autoconsumo PV
    EV satisfaction (0.30): SOC 90%
    Cost (0.10): Minimizar costo
    Grid stability (0.05): Suavizar picos
================================================================================
  ENTRENAMIENTO EN PROGRESO:
  ----------------------------------------------------------------------------
  [BESS REAL] Cargado: 8760 horas
  Step   5,000/87,600 (  5.7%) | Ep=0 | R_avg=  0.00 | 622 sps | ETA=2.2min
  Step  10,000/87,600 ( 11.4%) | Ep=1 | R_avg=2364.53 | 627 sps | ETA=2.1min
  Step  15,000/87,600 ( 17.1%) | Ep=1 | R_avg=2364.53 | 609 sps | ETA=2.0min
  Step  20,000/87,600 ( 22.8%) | Ep=2 | R_avg=2477.83 | 597 sps | ETA=1.9min
  Step  25,000/87,600 ( 28.5%) | Ep=2 | R_avg=2477.83 | 577 sps | ETA=1.8min
  Step  30,000/87,600 ( 34.2%) | Ep=3 | R_avg=2548.04 | 565 sps | ETA=1.7min
  Step  35,000/87,600 ( 40.0%) | Ep=3 | R_avg=2548.04 | 568 sps | ETA=1.5min
  Step  40,000/87,600 ( 45.7%) | Ep=4 | R_avg=2579.67 | 570 sps | ETA=1.4min
  Step  45,000/87,600 ( 51.4%) | Ep=5 | R_avg=2583.34 | 567 sps | ETA=1.3min
  Step  50,000/87,600 ( 57.1%) | Ep=5 | R_avg=2583.34 | 565 sps | ETA=1.1min
  Step  55,000/87,600 ( 62.8%) | Ep=6 | R_avg=2633.62 | 566 sps | ETA=1.0min
  Step  60,000/87,600 ( 68.5%) | Ep=6 | R_avg=2633.62 | 566 sps | ETA=0.8min
  Step  65,000/87,600 ( 74.2%) | Ep=7 | R_avg=2635.10 | 566 sps | ETA=0.7min
  Step  70,000/87,600 ( 79.9%) | Ep=7 | R_avg=2635.10 | 563 sps | ETA=0.5min
  Step  75,000/87,600 ( 85.6%) | Ep=8 | R_avg=2636.28 | 559 sps | ETA=0.4min
  Step  80,000/87,600 ( 91.3%) | Ep=9 | R_avg=2647.14 | 555 sps | ETA=0.2min
  Step  85,000/87,600 ( 97.0%) | Ep=9 | R_avg=2647.14 | 552 sps | ETA=0.1min
D:\dise±opvbesscar\scripts\train\train_a2c_multiobjetivo.py:1018: UserWarning: Glyph 9989 (\N{WHITE HEAVY CHECK MARK}) missing from font(s) DejaVu Sans.
  plt.tight_layout(rect=[0, 0, 1, 0.96])
D:\dise±opvbesscar\scripts\train\train_a2c_multiobjetivo.py:1019: UserWarning: Glyph 9989 (\N{WHITE HEAVY CHECK MARK}) missing from font(s) DejaVu Sans.
  plt.savefig(self.output_dir / 'kpi_dashboard.png', dpi=150)

  ­ƒôè Generando gr├íficos A2C...
     Ô£à a2c_entropy.png
     Ô£à a2c_policy_loss.png
     Ô£à a2c_value_loss.png
     Ô£à a2c_explained_variance.png
     Ô£à a2c_grad_norm.png
     Ô£à a2c_dashboard.png
     ­ƒôü Gr├íficos guardados en: outputs\a2c_training

  ­ƒôè Generando gr├íficos KPIs CityLearn...
     Ô£à kpi_electricity_consumption.png
     Ô£à kpi_electricity_cost.png
     Ô£à kpi_carbon_emissions.png
     Ô£à kpi_ramping.png
     Ô£à kpi_daily_peak.png
     Ô£à kpi_load_factor.png
     Ô£à kpi_dashboard.png
     ­ƒôü Gr├íficos KPIs guardados en: outputs\a2c_training

  Ô£ô RESULTADO ENTRENAMIENTO:
    Tiempo: 2.7 minutos (161 segundos)
    Timesteps ejecutados: 87,600
    Velocidad real: 545 timesteps/segundo
    Episodios completados: 10

[6] GUARDAR ARCHIVOS DE SALIDA
--------------------------------------------------------------------------------
  Ô£ô trace_a2c.csv: 87600 registros ÔåÆ outputs\a2c_training\trace_a2c.csv
  Ô£ô timeseries_a2c.csv: 87600 registros ÔåÆ outputs\a2c_training\timeseries_a2c.csv

[7] VALIDACION - 10 EPISODIOS
--------------------------------------------------------------------------------
  Episodio 1/10: Reward= 2854.12 | CO2_avoided= 5028127.5kg | Solar= 8292514.1kWh | Steps=8760
  Episodio 2/10: Reward= 2854.12 | CO2_avoided= 5028127.5kg | Solar= 8292514.1kWh | Steps=8760
  Episodio 3/10: Reward= 2854.12 | CO2_avoided= 5028127.5kg | Solar= 8292514.1kWh | Steps=8760
  Episodio 4/10: Reward= 2854.12 | CO2_avoided= 5028127.5kg | Solar= 8292514.1kWh | Steps=8760
  Episodio 5/10: Reward= 2854.12 | CO2_avoided= 5028127.5kg | Solar= 8292514.1kWh | Steps=8760
  Episodio 6/10: Reward= 2854.12 | CO2_avoided= 5028127.5kg | Solar= 8292514.1kWh | Steps=8760
  Episodio 7/10: Reward= 2854.12 | CO2_avoided= 5028127.5kg | Solar= 8292514.1kWh | Steps=8760
  Episodio 8/10: Reward= 2854.12 | CO2_avoided= 5028127.5kg | Solar= 8292514.1kWh | Steps=8760
  Episodio 9/10: Reward= 2854.12 | CO2_avoided= 5028127.5kg | Solar= 8292514.1kWh | Steps=8760
  Episodio 10/10: Reward= 2854.12 | CO2_avoided= 5028127.5kg | Solar= 8292514.1kWh | Steps=8760

  Ô£ô result_a2c.json: Resumen completo ÔåÆ outputs\a2c_training\result_a2c.json

================================================================================
RESULTADOS FINALES - VALIDACION 10 EPISODIOS:
================================================================================

  Ô×ñ M├ëTRICAS DE RECOMPENSA:
    Reward promedio                  2854.1190 puntos

  Ô×ñ REDUCCI├ôN CO2 (kg):
    Reducci├│n INDIRECTA (solar)     38526096.0 kg
    Reducci├│n DIRECTA (EVs)          9189328.3 kg
    Reducci├│n TOTAL                 47715424.3 kg
    CO2 evitado promedio/ep          5028127.5 kg

  Ô×ñ VEH├ìCULOS CARGADOS (m├íximo por episodio):
    Motos (de 112)                          19 unidades
    Mototaxis (de 16)                        8 unidades
    Total veh├¡culos                         27 / 38

  Ô×ñ ESTABILIDAD DE RED:
    Estabilidad promedio                  21.4 %
    Grid import promedio/ep          4805273.5 kWh

  Ô×ñ AHORRO ECON├ôMICO:
    Costo total (10 episodios)    $ 7223149.00 USD
    Costo promedio por episodio   $ 1345421.62 USD

  Ô×ñ CONTROL BESS:
    Descarga total BESS              6778357.3 kWh
    Carga total BESS                 7907155.7 kWh
    Acci├│n BESS promedio                 5.621 (0=carga, 1=descarga)

  Ô×ñ PROGRESO DE CONTROL SOCKETS:
    Setpoint promedio sockets            0.206 [0-1]
    Utilizaci├│n sockets                   52.4 %

  Ô×ñ SOLAR:
    Solar aprovechada por ep         8292514.1 kWh

  ARCHIVOS GENERADOS:
    Ô£ô outputs\a2c_training/result_a2c.json
    Ô£ô outputs\a2c_training/timeseries_a2c.csv
    Ô£ô outputs\a2c_training/trace_a2c.csv
    Ô£ô checkpoints\A2C/a2c_final_model.zip

  ESTADO: Entrenamiento A2C exitoso con datos reales OE2.

================================================================================
ENTRENAMIENTO A2C COMPLETADO
Traceback (most recent call last):
================================================================================
  File "D:\dise±opvbesscar\launch_a2c_training.py", line 28, in <module>
    from scripts.train.train_a2c_multiobjetivo import main
ImportError: cannot import name 'main' from 'scripts.train.train_a2c_multiobjetivo' (D:\dise±opvbesscar\scripts\train\train_a2c_multiobjetivo.py)
