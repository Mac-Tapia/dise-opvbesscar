­ƒÜÇ GPU: NVIDIA GeForce RTX 4060 Laptop GPU
   VRAM: 8.6 GB
   CUDA: 12.1
   Entrenamiento A2C en GPU (red 256x256, n_steps=8)
   Device: CUDA

[0] VALIDACION DE SINCRONIZACION A2C
--------------------------------------------------------------------------------

================================================================================
[VALIDACION] Sincronizacion A2C v7.0 - Datasets OE2 Completos
================================================================================
  [OK] 1. BESS Capacity (940 kWh)
  [OK] 2. BESS Max normalizacion (1700 kWh)
  [OK] 3. Solar Max (4100 kW)
  [OK] 4. Mall Max (150 kW)
  [OK] 5. Chargers CO2 cols (4)
  [OK] 6. BESS cols (25)
  [OK] 7. Solar cols (16)
  [OK] 8. Mall cols (6)
  [OK] 9. BESS obs cols (12)
  [OK] 10. Solar obs cols (10)

[OK] A2C sincronizado.\n
[0.5] VALIDACION CENTRALIZADA - ENTRENAMIENTO COMPLETO
--------------------------------------------------------------------------------

================================================================================
[VALIDACION DE ENTRENAMIENTO] A2C
================================================================================
  [OK] Episodes: 10 (CORRECTO)
  [OK] Timesteps: 87,600 (CORRECTO: 10 anos ├ù 8760)
  [OK] solar       : data/oe2/Generacionsolar/pv_generation_citylearn2024.csv (0.9 MB)
  [OK] chargers    : data/oe2/chargers/chargers_ev_ano_2024_v3.csv (16.3 MB)
  [OK] mall        : data/oe2/demandamallkwh/demandamallhorakwh.csv (0.4 MB)
  [OK] bess        : data/processed/citylearn/iquitos_ev_mall/bess_ano_2024.csv (1.6 MB)
  [OK] Observation dim: 156 (>=  27 requeridas)
  [OK] Action dim: 39 (1 BESS + 38 sockets)
  [OK] Reward weights loaded (co2_focus mode)
  [OK] CO2 factor: 0.4521
  [OK] Chargers: 19
  [OK] Total sockets: 38

================================================================================
[RESULTADO] [OK] A2C PREPARADO PARA ENTRENAMIENTO COMPLETO
================================================================================
Config:
  - Episodes: 10 (10 anos completos)
  - Timesteps: 87,600 (87,600 pasos)
  - Observation: 156 dims
  - Action: 39 dims
  - Datasets: TODOS cargados
  - Multiobjetivo: SI (27 columnas observables)
  - Validacion: OK [OK]
[OK] Entrenamiento COMPLETO garantizado: 10 episodios ├ù 87,600 steps ├ù 27 observables ├ù multiobjetivo.

[1] CARGAR CONFIGURACION Y CONTEXTO MULTIOBJETIVO
--------------------------------------------------------------------------------
  OK Config loaded: 5 keys
  REWARD WEIGHTS (ACTUALIZADOS 2026-02-08 - LOG SAC):
    CO2 grid (0.35): Minimizar importacion grid
    Solar (0.20): Autoconsumo PV
    EV satisfaction (0.30): SOC 90%
    Cost (0.10): Minimizar costo
    Grid stability (0.05): Suavizar picos
  [Valores cargados: CO2=0.35, Solar=0.20, EV=0.30, Cost=0.10, Grid=0.05]

  OK Contexto Iquitos:
    - Grid CO2: 0.4521 kg CO2/kWh
    - EV CO2 factor: 2.146 kg CO2/kWh
    - Chargers: 19
    - Sockets: 38
    - Daily capacity: 270 motos + 39 mototaxis

[2] CARGAR DATASET CITYLEARN V2 (COMPILADO)
--------------------------------------------------------------------------------
  Dataset precompilado: data\processed\citylearn\iquitos_ev_mall
  OK Dataset: data\processed\citylearn\iquitos_ev_mall

[3] CARGAR DATOS DEL DATASET CITYLEARN V2 CONSTRUIDO (8760 horas = 1 ano)
--------------------------------------------------------------------------------
  [SOLAR] REAL (CityLearn v2): columna=ac_power_kw | 8292514 kWh/ano (8760h)
  [CHARGERS] [OK] Cargando datos REALES desde: chargers_ev_ano_2024_v3.csv (353 columnas)
         CO2 directo motos: 312,459 kg/a├▒o
         CO2 directo mototaxis: 44,274 kg/a├▒o
         CO2 directo TOTAL: 356,734 kg/a├▒o
         Costo EV: S/. 161,105/a├▒o
  [CHARGERS] DATASET REAL: 38 sockets | Demanda: 2463312 kWh/ano | Promedio: 7.40 kW/socket
  [MALL] DATASET: 12368653 kWh/ano (promedio 1411.9 kW/h)
  [BESS] Cargando DATOS REALES COMPLETOS desde: bess_ano_2024.csv
  [BESS] METRICAS CARGADAS: 15 columnas
         SOC: 55.2% promedio
         CO2 evitado: 279,679 kg/ano
         Costo grid: S/. 2,300,787/ano
         Carga: 790,716 kWh | Descarga: 677,836 kWh
  [EV] Cargando DATOS REALES COMPLETOS desde: chargers_ev_ano_2024_v3.csv
  [EV] METRICAS CARGADAS: 5 arrays agregados
       SOC promedio: 32.2%
       Vehiculos activos: 98,812/ano
       Potencia carga: 453,349 kWh/ano
  [CHARGER STATS] (5to OE2): max_power=2.46-2.52 kW, mean=0.89 kW

[4] CREAR ENVIRONMENT CON DATOS OE2 REALES
--------------------------------------------------------------------------------
  OK Environment creado (v7.0 con TODOS los datos OE2)
    - Observation: (156,) (156-dim)
    - Action: (39,)
    - BESS metricas: ['soc', 'charge', 'discharge', 'to_ev', 'to_mall', 'pv_charge', 'grid_charge', 'co2_avoided', 'cost', 'tariff', 'peak_savings', 'grid_import', 'pv_to_ev', 'pv_to_mall', 'pv_curtailed']
    - EV metricas: ['soc_current', 'soc_target', 'active_count', 'charging_power', 'vehicle_count']
    - Chargers CO2: ['co2_motos_kg', 'co2_mototaxis_kg', 'co2_total_kg', 'cost_soles']

[5] CREAR A2C AGENT
--------------------------------------------------------------------------------
  OK A2C agent creado (DEVICE: CUDA)
    - Learning rate: 0.0003
    - N steps: 16
    - Gamma: 0.99
    - GAE lambda: 0.95
    - Entropy coef: 0.01
    - Value coef: 0.5
    - Max grad norm: 0.5
    - Use RMSProp: False
    - Normalize advantage: True

[6] ENTRENAR A2C
--------------------------------------------------------------------------------

================================================================================
  [GRAPH] CONFIGURACION ENTRENAMIENTO A2C (100% DATOS REALES OE2)
     Episodios: 10 ├ù 8,760 timesteps = 87,600 pasos
     Device: CUDA
     Velocidad: ~650 timesteps/segundo
     Duracion: ~134 segundos (GPU RTX 4060)
     Datos: REALES OE2 (chargers_ev_ano_2024_v3.csv 38 sockets, 940 kWh BESS, 4.05 MWp solar)
     Network: 256x256 (on-policy A2C), n_steps=8 (updates frecuentes)
     Output: result_a2c.json, timeseries_a2c.csv, trace_a2c.csv

  REWARD WEIGHTS (CO2_FOCUS):
    CO2 grid (0.35): Minimizar importacion
    Solar (0.20): Autoconsumo PV
    EV satisfaction (0.30): SOC 90%
    Cost (0.10): Minimizar costo
    Grid stability (0.05): Suavizar picos
================================================================================
  ENTRENAMIENTO EN PROGRESO:
  ----------------------------------------------------------------------------
  [BESS REAL] Cargado: 8760 horas
  Step   5,000/87,600 (  5.7%) | Ep=0 | R_avg=  0.00 | 619 sps | ETA=2.2min
  Step  10,000/87,600 ( 11.4%) | Ep=1 | R_avg=2176.21 | 594 sps | ETA=2.2min
  Step  15,000/87,600 ( 17.1%) | Ep=1 | R_avg=2176.21 | 572 sps | ETA=2.1min
  Step  20,000/87,600 ( 22.8%) | Ep=2 | R_avg=2251.74 | 552 sps | ETA=2.0min
  Step  25,000/87,600 ( 28.5%) | Ep=2 | R_avg=2251.74 | 540 sps | ETA=1.9min
  Step  30,000/87,600 ( 34.2%) | Ep=3 | R_avg=2338.16 | 538 sps | ETA=1.8min
  Step  35,000/87,600 ( 40.0%) | Ep=3 | R_avg=2338.16 | 539 sps | ETA=1.6min
  Step  40,000/87,600 ( 45.7%) | Ep=4 | R_avg=2394.58 | 542 sps | ETA=1.5min
  Step  45,000/87,600 ( 51.4%) | Ep=5 | R_avg=2453.62 | 544 sps | ETA=1.3min
  Step  50,000/87,600 ( 57.1%) | Ep=5 | R_avg=2453.62 | 545 sps | ETA=1.1min
  Step  55,000/87,600 ( 62.8%) | Ep=6 | R_avg=2575.50 | 545 sps | ETA=1.0min
  Step  60,000/87,600 ( 68.5%) | Ep=6 | R_avg=2575.50 | 543 sps | ETA=0.8min
  Step  65,000/87,600 ( 74.2%) | Ep=7 | R_avg=2674.78 | 542 sps | ETA=0.7min
  Step  70,000/87,600 ( 79.9%) | Ep=7 | R_avg=2674.78 | 540 sps | ETA=0.5min
  Step  75,000/87,600 ( 85.6%) | Ep=8 | R_avg=2739.85 | 538 sps | ETA=0.4min
  Step  80,000/87,600 ( 91.3%) | Ep=9 | R_avg=2806.48 | 536 sps | ETA=0.2min
  Step  85,000/87,600 ( 97.0%) | Ep=9 | R_avg=2806.48 | 534 sps | ETA=0.1min

  [GRAPH] Generando graficos A2C...
     [OK] a2c_entropy.png
     [OK] a2c_policy_loss.png
     [OK] a2c_value_loss.png
     [OK] a2c_explained_variance.png
     [OK] a2c_grad_norm.png
     [OK] a2c_dashboard.png
     ­ƒôü Graficos guardados en: outputs\a2c_training

  [GRAPH] Generando graficos KPIs CityLearn...
     [OK] kpi_electricity_consumption.png
     [OK] kpi_electricity_cost.png
     [OK] kpi_carbon_emissions.png
     [OK] kpi_ramping.png
     [OK] kpi_daily_peak.png
     [OK] kpi_load_factor.png
     [OK] kpi_dashboard.png
     ­ƒôü Graficos KPIs guardados en: outputs\a2c_training

  [OK] RESULTADO ENTRENAMIENTO:
    Tiempo: 2.8 minutos (166 segundos)
    Timesteps ejecutados: 87,600
    Velocidad real: 527 timesteps/segundo
    Episodios completados: 10

[6] GUARDAR ARCHIVOS DE SALIDA
--------------------------------------------------------------------------------
  [OK] trace_a2c.csv: 87600 registros -> outputs\a2c_training\trace_a2c.csv
  [OK] timeseries_a2c.csv: 87600 registros -> outputs\a2c_training\timeseries_a2c.csv

[7] VALIDACION - 10 EPISODIOS
--------------------------------------------------------------------------------
  Episodio 1/10: Reward= 2933.78 | CO2_avoided=  537986.2kg | Solar= 8292514.1kWh | Steps=8760
  Episodio 2/10: Reward= 2933.78 | CO2_avoided=  537986.2kg | Solar= 8292514.1kWh | Steps=8760
  Episodio 3/10: Reward= 2933.78 | CO2_avoided=  537986.2kg | Solar= 8292514.1kWh | Steps=8760
  Episodio 4/10: Reward= 2933.78 | CO2_avoided=  537986.2kg | Solar= 8292514.1kWh | Steps=8760
  Episodio 5/10: Reward= 2933.78 | CO2_avoided=  537986.2kg | Solar= 8292514.1kWh | Steps=8760
  Episodio 6/10: Reward= 2933.78 | CO2_avoided=  537986.2kg | Solar= 8292514.1kWh | Steps=8760
  Episodio 7/10: Reward= 2933.78 | CO2_avoided=  537986.2kg | Solar= 8292514.1kWh | Steps=8760
  Episodio 8/10: Reward= 2933.78 | CO2_avoided=  537986.2kg | Solar= 8292514.1kWh | Steps=8760
  Episodio 9/10: Reward= 2933.78 | CO2_avoided=  537986.2kg | Solar= 8292514.1kWh | Steps=8760
  Episodio 10/10: Reward= 2933.78 | CO2_avoided=  537986.2kg | Solar= 8292514.1kWh | Steps=8760

  [OK] result_a2c.json: Resumen completo -> outputs\a2c_training\result_a2c.json

================================================================================
RESULTADOS FINALES - VALIDACION 10 EPISODIOS:
================================================================================

  Ô×ñ METRICAS DE RECOMPENSA:
    Reward promedio                  2933.7801 puntos

  Ô×ñ REDUCCION CO2 (kg):
    Reduccion INDIRECTA (solar)      2796790.5 kg
    Reduccion DIRECTA (EVs)          2063312.5 kg
    Reduccion TOTAL                  4860103.0 kg
    CO2 evitado promedio/ep           537986.2 kg

  Ô×ñ VEHICULOS CARGADOS (maximo por episodio):
    Motos (de 112)                          23 unidades
    Mototaxis (de 16)                        8 unidades
    Total vehiculos                         31 / 38

  Ô×ñ ESTABILIDAD DE RED:
    Estabilidad promedio                  20.6 %
    Grid import promedio/ep          4870524.0 kWh

  Ô×ñ AHORRO ECONOMICO:
    Costo total (10 episodios)    $ 7349029.50 USD
    Costo promedio por episodio   $ 1363697.62 USD

  Ô×ñ CONTROL BESS:
    Descarga total BESS              6778357.3 kWh
    Carga total BESS                 7907155.7 kWh
    Accion BESS promedio                 4.723 (0=carga, 1=descarga)

  Ô×ñ PROGRESO DE CONTROL SOCKETS:
    Setpoint promedio sockets            1.107 [0-1]
    Utilizacion sockets                   62.4 %

  Ô×ñ SOLAR:
    Solar aprovechada por ep         8292514.1 kWh

  ARCHIVOS GENERADOS:
    [OK] outputs\a2c_training/result_a2c.json
    [OK] outputs\a2c_training/timeseries_a2c.csv
    [OK] outputs\a2c_training/trace_a2c.csv
    [OK] checkpoints\A2C/a2c_final_model.zip

  ESTADO: Entrenamiento A2C exitoso con datos reales OE2.

================================================================================
ENTRENAMIENTO A2C COMPLETADO
================================================================================
================================================================================
ENTRENAR A2C - CON MULTIOBJETIVO REAL (CO2, SOLAR, COST, EV, GRID)
================================================================================
Inicio: 2026-02-14 23:19:16

